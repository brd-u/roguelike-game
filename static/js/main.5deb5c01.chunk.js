(this["webpackJsonproguelike-game"]=this["webpackJsonproguelike-game"]||[]).push([[0],{27:function(t,e,i){"use strict";i.r(e);var n=i(9),a=i.n(n),s=i(18),r=i.n(s),o=i(8),c=i(0),h=i(1),l=function(){function t(){var e=this;Object(c.a)(this,t),this.observers=[],this.handleKeys=function(t){switch(t.preventDefault(),t.keyCode){case 37:e.broadcast("move",{x:-1,y:0});break;case 38:e.broadcast("move",{x:0,y:-1});break;case 39:e.broadcast("move",{x:1,y:0});break;case 40:e.broadcast("move",{x:0,y:1})}}}return Object(h.a)(t,[{key:"subscribe",value:function(t){this.observers.push(t)}},{key:"unsubscribe",value:function(t){var e=this;this.observers=this.observers.filter((function(i){return e.subscribe!==t}))}},{key:"broadcast",value:function(t,e){this.observers.forEach((function(i){i(t,e)}))}},{key:"bindKeys",value:function(){document.addEventListener("keydown",this.handleKeys)}},{key:"unbindKeys",value:function(){document.removeEventListener("keydown",this.handleKeys)}}]),t}(),u=i(4),d=i(3),f=i(20),y=function(){function t(e,i,n,a){Object(c.a)(this,t),this.x=e,this.y=i,this.size=n,this.attributes=Object(f.a)({},a)}return Object(h.a)(t,[{key:"action",value:function(t,e){console.log("Verb: ".concat(t))}},{key:"draw",value:function(t){t.fillStyle=this.attributes.color||"white",t.textBaseline="hanging",t.font="16px Halvetica",t.fillText(this.attributes.ascii,this.x*this.size+(this.attributes.offset?this.attributes.offset.x:0),this.y*this.size+(this.attributes.offset?this.attributes.offset.y:0))}}]),t}(),b=function(t){Object(u.a)(i,t);var e=Object(d.a)(i);function i(){var t;Object(c.a)(this,i);for(var n=arguments.length,a=new Array(n),s=0;s<n;s++)a[s]=arguments[s];return(t=e.call.apply(e,[this].concat(a))).inventory=[],t.attributes={name:"Player",ascii:"@",health:10},t}return Object(h.a)(i,[{key:"move",value:function(t,e){this.attributes.health<=0||(this.x+=t,this.y+=e)}},{key:"add",value:function(t){this.inventory.push(t)}},{key:"copyPlayer",value:function(){var t=new i;return Object.assign(t,this),t}}]),i}(y),v=function(t){Object(u.a)(i,t);var e=Object(d.a)(i);function i(){return Object(c.a)(this,i),e.apply(this,arguments)}return Object(h.a)(i,[{key:"action",value:function(t,e){"bump"===t&&(e.player.add(this),e.remove(this)),"drop"===t&&console.log("drop",this)}}]),i}(y),w=function(t){Object(u.a)(i,t);var e=Object(d.a)(i);function i(){return Object(c.a)(this,i),e.apply(this,arguments)}return Object(h.a)(i,[{key:"action",value:function(t,e){"bump"===t&&(e.addToHistory("Player attacks".concat(this.attributes.name,"!")),this.attributes.health=this.attributes.health-1,this.attributes.health<=0?(e.addToHistory("".concat(this.attributes.name," dies!")),e.remove(this)):(e.addToHistory("".concat(this.attributes.name,"'s health = ").concat(this.attributes.health)),e.player.attributes.health=e.player.attributes.health-1,e.player.attributes.health<=0?e.addToHistory("You have died!"):e.addToHistory("You have ".concat(e.player.attributes.health," health"))))}}]),i}(y),p=[{name:"Long Sword",color:"darkgrey",ascii:"/",offset:{x:6,y:3}},{name:"Health Potion",color:"red",ascii:"!",offset:{x:6,y:3}},{name:"Gold coin",color:"yellow",ascii:"$",offset:{x:3,y:3}},{name:"Light Armor",color:"lightgrey",ascii:"#",offset:{x:4,y:3}}],m=[{name:"Kobold",color:"green",ascii:"K",offset:{x:4,y:3},health:3},{name:"Dragon",color:"darkred",ascii:"D",offset:{x:6,y:3},health:5},{name:"Slime",color:"darkGreen",ascii:"S",offset:{x:3,y:2},health:2}];function g(t){return Math.floor(Math.random()*Math.floor(t))}var j=function(){function t(e){Object(c.a)(this,t),this.world=e}return Object(h.a)(t,[{key:"spawn",value:function(t,e){for(var i=0;i<t;i++){var n=e();this.world.add(n),this.world.moveToSpace(n)}}},{key:"spawnLoot",value:function(t){var e=this;this.spawn(t,(function(){return new v(g(e.world.width-1),g(e.world.height-1),e.world.tilesize,p[g(p.length)])}))}},{key:"spawnMonsters",value:function(t){var e=this;this.spawn(t,(function(){return new w(g(e.world.width-1),g(e.world.height-1),e.world.tilesize,m[g(p.length)])}))}}]),t}(),k=i(19),O=function(){function t(e,i,n){Object(c.a)(this,t),this.width=e,this.height=i,this.tilesize=n,this.entities=[new b(0,0,16)],this.history=["You enter the dengeon","---"],this.worldmap=new Array(this.width);for(var a=0;a<this.width;a++)this.worldmap[a]=new Array(this.height)}return Object(h.a)(t,[{key:"player",get:function(){return this.entities[0]}},{key:"add",value:function(t){this.entities.push(t)}},{key:"remove",value:function(t){this.entities=this.entities.filter((function(e){return e!==t}))}},{key:"moveToSpace",value:function(t){for(var e=t.x;e<this.width;e++)for(var i=t.y;i<this.height;i++)if(0===this.worldmap[e][i]&&!this.getEntityAtLocation(e,i))return t.x=e,void(t.y=i)}},{key:"isWall",value:function(t,e){return void 0===this.worldmap[t]||void 0===this.worldmap[e]||1===this.worldmap[t][e]}},{key:"getEntityAtLocation",value:function(t,e){return this.entities.find((function(i){return i.x===t&&i.y===e}))}},{key:"movePlayer",value:function(t,e){var i=this.player.copyPlayer();i.move(t,e);var n=this.getEntityAtLocation(i.x,i.y);if(n)return console.log(n),void n.action("bump",this);this.isWall(i.x,i.y)?console.log("Way blocked at ".concat(i.x,":").concat(i.y,"!")):this.player.move(t,e)}},{key:"createCellularMap",value:function(){var t=this,e=new k.a.Cellular(this.width,this.height,{connected:!0});e.randomize(.5);var i=function(e,i,n){0!==e&&0!==i&&e!==t.width-1&&i!==t.height-1?t.worldmap[e][i]=0===n?1:0:t.worldmap[e][i]=1};e.create(i),e.connect(i,1)}},{key:"draw",value:function(t){for(var e=0;e<this.width;e++)for(var i=0;i<this.height;i++)1===this.worldmap[e][i]&&this.drawWall(t,e,i);this.entities.forEach((function(e){e.draw(t)}))}},{key:"drawWall",value:function(t,e,i){t.fillStyle="#000",t.fillRect(e*this.tilesize,i*this.tilesize,this.tilesize,this.tilesize)}},{key:"addToHistory",value:function(t){this.history.push(t),this.history.length>6&&this.history.shift()}}]),t}(),x=i(7),z=function(t){var e=t.width,i=t.height,s=t.tilesize,r=a.a.useRef(),c=Object(n.useState)(new O(e,i,s)),h=Object(o.a)(c,2),u=h[0],d=h[1],f=new l,y=function(t,e){console.log("handle input:".concat(t,":").concat(JSON.stringify(e)));var i=new O;Object.assign(i,u),i.movePlayer(e.x,e.y),d(i)};return Object(n.useEffect)((function(){console.log("Create Map!");var t=new O;Object.assign(t,u),t.createCellularMap(),t.moveToSpace(u.player);var e=new j(t);e.spawnLoot(10),d(t),e.spawnMonsters(6)}),[]),Object(n.useEffect)((function(){return console.log("Bind input"),f.bindKeys(),f.subscribe(y),function(){f.unbindKeys(),f.unsubscribe(y)}})),Object(n.useEffect)((function(){console.log("Draw to canvas");var t=r.current.getContext("2d");t.clearRect(0,0,e*s,i*s),u.draw(t),u.draw(t)})),Object(x.jsxs)(x.Fragment,{children:[Object(x.jsx)("canvas",{ref:r,width:e*s,height:i*s,style:{border:"1px solid black",background:"DimGray"}}),Object(x.jsx)("ul",{children:u.player.inventory.map((function(t,e){return Object(x.jsx)("li",{children:t.attributes.name},e)}))}),Object(x.jsx)("ul",{children:u.history.map((function(t,e){return Object(x.jsx)("li",{children:t},e)}))})]})},E=function(){return Object(x.jsx)("div",{className:"App",children:Object(x.jsx)(z,{width:40,height:40,tilesize:16})})};r.a.render(Object(x.jsx)(a.a.StrictMode,{children:Object(x.jsx)(E,{})}),document.getElementById("root"))}},[[27,1,2]]]);
//# sourceMappingURL=main.5deb5c01.chunk.js.map